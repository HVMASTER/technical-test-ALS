<div *ngIf="informes" class="list-container">
  <div *ngIf="!selectedInforme" class="informes-list">
    <ul>
      <li *ngFor="let informe of informes" (click)="selectInforme(informe)">
        {{ informe.numeroInforme }}
      </li>
    </ul>
  </div>
</div>

<button (click)="deselectInforme()" class="back-button">Volver</button>
<button (click)="togglePreview()">Vista Previa</button>
<button (click)="generatePDF()">Exportar a PDF</button>
<div *ngIf="isLoading" class="loading-bar">
  <div class="spinner"></div>
</div>

<div *ngIf="isSaving" class="loading-bar">
  <div class="spinner"></div>
  <p>{{ savingMessage }}</p>
</div>

<div *ngIf="!isLoading">
  <div *ngIf="selectedInforme" class="form-container">
    <div *ngIf="isLoadingPdf" class="loading-bar">
      <p>Generando PDF, por favor espere...</p>
      <div class="spinner"></div>
    </div>
    <div id="contentToConvert">
      <div *ngIf="showHeaderFooter" class="header">
        <app-header></app-header>
      </div>
      <div class="title-main">
        <h1>
          INFORME DE INSPECCIÓN Y PRUEBA DE CARGA A GRÚAS FIJAS y MÓVILES EN
          PUERTO
        </h1>
      </div>

      <div class="page">
        <div class="content">
          <form [formGroup]="informeForm" class="A-C">
            <div *ngIf="!isPreviewMode" class="edit-save-buttons">
              <button (click)="toggleEdit()">
                {{ isEditing ? "Cancelar" : "Editar" }}
              </button>
              <button *ngIf="isEditing" (click)="saveChanges()">Guardar</button>
            </div>

            <div class="form-row">
              <div class="title">
                <label>Informe N°</label>
              </div>
              <label>{{ informeForm.get("numeroInforme")?.value }}</label>
              <label>Certificado asociado N°</label>
              <ng-container *ngIf="isEditing; else viewCertificado">
                <input formControlName="numeroInforme" type="text" />
              </ng-container>
              <ng-template #viewCertificado>
                <label>{{ informeForm.get("numeroInforme")?.value }}</label>
              </ng-template>
            </div>
            <div class="form-row">
              <div class="title">
                <label>Solicitado por</label>
              </div>
              <label>Empresa</label>
              <ng-container *ngIf="isEditing; else viewEmpresa">
                <input formControlName="empresa" type="text" />
              </ng-container>
              <ng-template #viewEmpresa>
                <label>{{ informeForm.get("empresa")?.value }}</label>
              </ng-template>
              <label>Persona</label>
              <ng-container *ngIf="isEditing; else viewPersona">
                <input formControlName="persona" type="text" />
              </ng-container>
              <ng-template #viewPersona>
                <label>{{ informeForm.get("persona")?.value }}</label>
              </ng-template>
            </div>
            <div class="form-row">
              <div class="title">
                <label>Equipo</label>
              </div>
              <ng-container *ngIf="isEditing; else viewEquipo">
                <input formControlName="equipo" type="text" />
              </ng-container>
              <ng-template #viewEquipo>
                <label>{{ informeForm.get("equipo")?.value }}</label>
              </ng-template>
            </div>
            <div class="form-row">
              <div class="title">
                <label>Marca</label>
              </div>
              <ng-container *ngIf="isEditing; else viewMarca">
                <input formControlName="marca" type="text" />
              </ng-container>
              <ng-template #viewMarca>
                <label>{{ informeForm.get("marca")?.value }}</label>
              </ng-template>
            </div>

            <div class="form-row">
              <div class="form-row-custom">
                <div class="column-title-main text-right">
                  <label>Carga segura de trabajo (SWL)</label>
                </div>
                <div class="column-data">
                  <ng-container *ngIf="isEditing; else viewCargaSegura">
                    <input formControlName="cargaSegura" type="text" />
                  </ng-container>
                  <ng-template #viewCargaSegura>
                    <label
                      >{{
                        informeForm.get("cargaSegura")?.value || "N/A"
                      }}
                      ton</label
                    >
                  </ng-template>

                  <ng-container *ngIf="isEditing; else viewCargaSeguraDos">
                    <input formControlName="cargaSeguraDo" type="text" />
                  </ng-container>
                  <ng-template #viewCargaSeguraDos>
                    <label
                      >{{
                        informeForm.get("cargaSeguraDo")?.value || "N/A"
                      }}
                      ton</label
                    >
                  </ng-template>
                </div>

                <div class="column-title">
                  <label>Ángulo</label>
                </div>
                <div class="column-data">
                  <ng-container *ngIf="isEditing; else viewAngulo">
                    <input formControlName="angulo" type="text" />
                  </ng-container>
                  <ng-template #viewAngulo>
                    <label
                      >{{ informeForm.get("angulo")?.value || "N/A" }}°</label
                    >
                  </ng-template>

                  <ng-container *ngIf="isEditing; else viewAnguloDos">
                    <input formControlName="anguloDos" type="text" />
                  </ng-container>
                  <ng-template #viewAnguloDos>
                    <label
                      >{{
                        informeForm.get("anguloDos")?.value || "N/A"
                      }}°</label
                    >
                  </ng-template>
                </div>

                <div class="column-title">
                  <label>Radio</label>
                </div>
                <div class="column-data">
                  <ng-container *ngIf="isEditing; else viewRadio">
                    <input formControlName="radio" type="text" />
                  </ng-container>
                  <ng-template #viewRadio>
                    <label
                      >{{ informeForm.get("radio")?.value || "N/A" }} m</label
                    >
                  </ng-template>

                  <ng-container *ngIf="isEditing; else viewRadioDos">
                    <input formControlName="radioDos" type="text" />
                  </ng-container>
                  <ng-template #viewRadioDos>
                    <label
                      >{{
                        informeForm.get("radioDos")?.value || "N/A"
                      }}
                      m</label
                    >
                  </ng-template>
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="title">
                <label>TAG / ID #</label>
              </div>
              <ng-container *ngIf="isEditing; else viewTag">
                <input formControlName="tag" type="text" />
              </ng-container>
              <ng-template #viewTag>
                <label>{{ informeForm.get("Tag")?.value }}</label>
              </ng-template>
            </div>
            <div class="form-row">
              <div class="title">
                <label>Lugar de inspección y prueba</label>
              </div>
              <ng-container *ngIf="isEditing; else viewLugarInspeccion">
                <input formControlName="lugarInspeccion" type="text" />
              </ng-container>
              <ng-template #viewLugarInspeccion>
                <label>{{ informeForm.get("lugarInspeccion")?.value }}</label>
              </ng-template>
            </div>
            <div class="form-row">
              <div class="title">
                <label>Fecha de inspección y prueba</label>
              </div>
              <ng-container *ngIf="isEditing; else viewFechaInspeccion">
                <input formControlName="fechaInspeccion" type="date" />
              </ng-container>
              <ng-template #viewFechaInspeccion>
                <label>{{ informeForm.get("fechaInspeccion")?.value }}</label>
              </ng-template>
            </div>
            <div class="form-row">
              <div class="title">
                <label>Fecha de emisión informe</label>
              </div>
              <label>{{ fechaEmisionInforme }}</label>
            </div>
            <div class="subtitle">
              <h3 class="custom-h3">
                <strong>(CU)</strong> CUMPLE <strong>(N/C)</strong> NO CUMPLE NO
                APLICA
                <strong>(N/A)</strong>
                RECOMENDACIÓN
                <strong>(RE)</strong>
              </h3>
            </div>

            <h2 class="subtitle" *ngIf="tituloForm.length > 0">
              {{ tituloForm[0]?.nombre }}
            </h2>
            <!-- <div *ngIf="!isPreviewMode" class="edit-save-buttons">
              <button (click)="toggleEditStatusA()">
                {{ isEditingStatusA ? "Cancelar" : "Editar" }}
              </button>
              <button *ngIf="isEditingStatusA" (click)="saveChangesStatusA()">
                Guardar
              </button>
            </div> -->
            <div class="form-row-A-F">
              <strong class="center">Item</strong>
              <strong class="center">Detalle</strong>
              <strong class="center">Status</strong>
              <strong class="center">Item</strong>
              <strong class="center">Detalle</strong>
              <strong class="center">Status</strong>
            </div>

            <div
              *ngFor="
                let item of itemsWithStatus | slice : 0 : 9;
                let i = index
              "
              class="form-row-A-F"
            >
              <!-- Primera columna, numeración del 1 al 9 -->
              <label class="center"
                ><strong>{{ i + 1 }}</strong></label
              >
              <label title="{{ item.detalle }}">{{ item.detalle }}</label>
              <div *ngIf="isEditingStatusA; else viewMode">
                <div class="options-list">
                  <form>
                    <label *ngFor="let option of optionStatus">
                      <input
                        type="radio"
                        name="option_{{ i }}"
                        [value]="option.idStatus"
                        [checked]="option.alias === item.alias"
                        (change)="
                          selectStatus(
                            itemsWithStatus[i],
                            option.idStatus.toString(),
                            i
                          )
                        "
                      />
                      {{ option.alias }}
                    </label>
                  </form>
                </div>
              </div>
              <ng-template #viewMode>
                <label class="center">{{ item.alias }}</label>
              </ng-template>

              <!-- Segunda columna, numeración del 10 al 18 -->
              <ng-container *ngIf="9 + i < itemsWithStatus.length">
                <label class="center"
                  ><strong>{{ 10 + i }}</strong></label
                >
                <label title="{{ itemsWithStatus[9 + i].detalle }}">{{
                  itemsWithStatus[9 + i]?.detalle
                }}</label>
                <div *ngIf="isEditingStatusA; else viewMode2">
                  <div class="options-list">
                    <form>
                      <label *ngFor="let option of optionStatus">
                        <input
                          type="radio"
                          name="option_{{ 9 + i }}"
                          [value]="option.idStatus"
                          [checked]="
                            option.alias === itemsWithStatus[9 + i]?.alias
                          "
                          (change)="
                            selectStatus(
                              itemsWithStatus[9 + i],
                              option.idStatus.toString(),
                              9 + i
                            )
                          "
                        />
                        {{ option.alias }}
                      </label>
                    </form>
                  </div>
                </div>
                <ng-template #viewMode2>
                  <label class="center">{{
                    itemsWithStatus[9 + i]?.alias
                  }}</label>
                </ng-template>
              </ng-container>
            </div>

            <h2 class="subtitle" *ngIf="tituloForm.length > 0">
              {{ tituloForm[1].nombre }}
            </h2>
            <!-- <div *ngIf="!isPreviewMode">
              <button (click)="toggleEditStatusB()">
                {{ isEditingStatusB ? "Cancelar" : "Editar" }}
              </button>
              <button *ngIf="isEditingStatusB" (click)="saveChangesStatusB()">
                Guardar
              </button>
            </div> -->
            <div class="form-row-A-F">
              <strong class="center">Item</strong>
              <strong class="center">Detalle</strong>
              <strong class="center">Status</strong>
              <strong class="center">Item</strong>
              <strong class="center">Detalle</strong>
              <strong class="center">Status</strong>
            </div>
            <div
              *ngFor="
                let item of itemsWithStatus | slice : 18 : 25;
                let i = index
              "
              class="form-row-A-F"
            >
              <!-- Primera columna, numeración del 19 al 25 -->
              <label class="center"
                ><strong>{{ 19 + i }}</strong></label
              >
              <label title="{{ item.detalle }}">{{ item.detalle }}</label>
              <div *ngIf="isEditingStatusB; else viewMode">
                <div class="options-list">
                  <form>
                    <label *ngFor="let option of optionStatus">
                      <input
                        type="radio"
                        name="option_{{ 18 + i }}"
                        [value]="option.idStatus"
                        [checked]="option.alias === item.alias"
                        (change)="
                          selectStatus(
                            itemsWithStatus[18 + i],
                            option.idStatus.toString(),
                            18 + i
                          )
                        "
                      />
                      {{ option.alias }}
                    </label>
                  </form>
                </div>
              </div>
              <ng-template #viewMode>
                <label class="center">{{ item.alias }}</label>
              </ng-template>

              <!-- Segunda columna, numeración del 26 al 31 -->
              <ng-container *ngIf="25 + i < itemsWithStatus.length && i < 6">
                <label class="center"
                  ><strong>{{ 26 + i }}</strong></label
                >
                <label title="{{ itemsWithStatus[25 + i].detalle }}">{{
                  itemsWithStatus[25 + i]?.detalle
                }}</label>
                <div *ngIf="isEditingStatusB; else viewMode2">
                  <div class="options-list">
                    <form>
                      <label *ngFor="let option of optionStatus">
                        <input
                          type="radio"
                          name="option_{{ 25 + i }}"
                          [value]="option.idStatus"
                          [checked]="
                            option.alias === itemsWithStatus[25 + i]?.alias
                          "
                          (change)="
                            selectStatus(
                              itemsWithStatus[25 + i],
                              option.idStatus.toString(),
                              25 + i
                            )
                          "
                        />
                        {{ option.alias }}
                      </label>
                    </form>
                  </div>
                </div>
                <ng-template #viewMode2>
                  <label class="center">{{
                    itemsWithStatus[25 + i]?.alias
                  }}</label>
                </ng-template>
              </ng-container>

              <!-- Espacio vacío para el ítem 32 -->
              <ng-container *ngIf="i === 6">
                <label class="center"><strong>-</strong></label>
                <label></label>
                <label></label>
              </ng-container>
            </div>
          </form>
        </div>
      </div>

        <div class="page">
            <div class="content">
                <form class="C-D">
                    <h2 class="subtitle" *ngIf="tituloForm.length > 0">
              {{ tituloForm[2].nombre }}
            </h2>
            <!-- <div *ngIf="!isPreviewMode" class="edit-save-buttons">
              <button type="button" (click)="toggleEditStatusC()">
                {{ isEditingStatusC ? "Cancelar" : "Editar" }}
              </button>
              <button
                type="button"
                *ngIf="isEditingStatusC"
                (click)="saveChangesStatusC()"
              >
                Guardar
              </button>
            </div> -->
            <div class="form-row-A-F">
              <strong class="center">Item</strong>
              <strong class="center">Detalle</strong>
              <strong class="center">Status</strong>
              <strong class="center">Item</strong>
              <strong class="center">Detalle</strong>
              <strong class="center">Status</strong>
            </div>
            <div
  *ngFor="let item of itemsWithStatus | slice: 31 : 41; let i = index"
  class="form-row-A-F"
>
  <!-- Primera columna, numeración del 32 al 41 -->
  <label class="center"><strong>{{ 32 + i }}</strong></label>
  <label title="{{ item.detalle }}">{{ item.detalle }}</label>
  <div *ngIf="isEditingStatusC; else viewModeC">
    <div class="options-list">
      <label *ngFor="let option of optionStatus">
        <input
          type="radio"
          name="option_{{ 31 + i }}"
          [value]="option.idStatus"
          [checked]="option.alias === item.alias"
          (change)="
            selectStatus(
              itemsWithStatus[31 + i],
              option.idStatus.toString(),
              31 + i
            )
          "
        />
        {{ option.alias }}
      </label>
    </div>
  </div>
  <ng-template #viewModeC>
    <label class="center">{{ item.alias }}</label>
  </ng-template>

  <!-- Segunda columna, numeración del 42 al 51 -->
  <ng-container *ngIf="41 + i < itemsWithStatus.length && i < 10">
    <label class="center"><strong>{{ 42 + i }}</strong></label>
    <label title="{{ itemsWithStatus[41 + i].detalle }}">{{ itemsWithStatus[41 + i]?.detalle }}</label>
    <div *ngIf="isEditingStatusC; else viewModeC2">
      <div class="options-list">
        <label *ngFor="let option of optionStatus">
          <input
            type="radio"
            name="option_{{ 41 + i }}"
            [value]="option.idStatus"
            [checked]="option.alias === itemsWithStatus[41 + i]?.alias"
            (change)="
              selectStatus(
                itemsWithStatus[41 + i],
                option.idStatus.toString(),
                41 + i
              )
            "
          />
          {{ option.alias }}
        </label>
      </div>
    </div>
    <ng-template #viewModeC2>
      <label class="center">{{ itemsWithStatus[41 + i]?.alias }}</label>
    </ng-template>
  </ng-container>
</div>

<h2 class="subtitle" *ngIf="tituloForm.length > 0">
              {{ tituloForm[3].nombre }}
            </h2>
            <!-- <div *ngIf="!isPreviewMode" class="edit-save-buttons">
              <button type="button" (click)="toggleEditDescription()">
                {{ isEditingFormG ? "Cancelar" : "Editar" }}
              </button>
              <button
                type="button"
                *ngIf="isEditingFormG"
                (click)="saveChangesDescription()"
              >
                Guardar
              </button>
            </div> -->
            <form class="padding-none">
              <div class="form-row-G">
                <strong class="center">ÍTEM</strong>
                <strong class="center">COND</strong>
                <strong class="center">DESCRIPCIÓN</strong>
              </div>

              <!-- Mostrar las descripciones -->
              <div [formGroup]="informeForm">
                <div
                  *ngFor="let descripcion of descripcionItems; let i = index"
                  class="form-row-G editInputFormG"
                >
                  <label class="center"
                    ><strong>{{ descripcion.idDetalle }}</strong></label
                  >
                  <label class="center">{{
                    getStatusLabel(descripcion.idStatus)
                  }}</label>

                  <div *ngIf="isEditingFormD; else viewModeFormD">
                    <input
                      [formControlName]="'descripcion_' + i"
                      type="text"
                      class="edit-input"
                    />
                  </div>
                  <ng-template #viewModeFormD>
                    <label>{{ descripcion.descripcion }}</label>
                  </ng-template>
                </div>
              </div>

              <!-- Mostrar filas vacías por defecto -->
              <div
                *ngFor="let i of defaultEmptyRows"
                class="form-row-G editInputFormG"
              >
                <label class="center"><strong>&nbsp;</strong></label>
                <label class="center">&nbsp;</label>
                <label class="center">&nbsp;</label>
              </div>
            </form>
            <h2>Notas en columna descripción:</h2>
            <ul>
              <h2>
                - La palabra <strong>“debe”</strong> indica un requisito.Se
                relaciona con una no conformidad (N/C) y debe ser corregida por
                el cliente.
              </h2>
              <h2>
                - La palabra <strong>“debería”</strong> indica una
                recomendación/observación (RE). Puede o no ser tratada por el
                cliente.
              </h2>
            </ul>
            <h3>
              Nota <span class="underline">muy importante</span>: Si
              correspondiesen acciones correctivas (por no conformidades, n/c),
              estas deberán ser solucionadas o tratadas por el cliente en el
              menor tiempo posible con el fin de reducir los riesgos asociados
              de mantener en operación un equipo sub-estándar.
            </h3>
            <h3 class="custom-h3 font-italic">
              Las observaciones importantes de seguridad (N/C) deberán, si
              corresponde, ser levantadas mediante el documento “levantamiento
              de no conformidades”.
            </h3>

                </form>
            </div>
        </div>

    </div>
  </div>
</div>
